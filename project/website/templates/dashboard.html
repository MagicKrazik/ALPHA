{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard Médico - ALPHA Project{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}

<!-- dashboard.html -->
<div class="section dashboard-section">
    <div class="container">
        <!-- Statistics Overview -->
        <div class="stats-overview" aos="fade-up">
            <div class="stat-card">
                <div class="stat-title">Total Pacientes</div>
                <div class="stat-value">{{ stats.total_patients }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Cirugías Realizadas</div>
                <div class="stat-value">{{ stats.completed_surgeries }}</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-title">Vías Aéreas Difíciles</div>
                <div class="stat-value">{{ airway_metrics.difficult_airways }}</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-title">Casos de Alto Riesgo</div>
                <div class="stat-value">{{ complications_data.with_complications }}</div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid">
            <!-- ASA Distribution -->
            <div class="chart-card">
                <h3>Distribución ASA</h3>
                <canvas id="asaChart"></canvas>
            </div>
            
            <!-- Complications -->
            <div class="chart-card">
                <h3>Complicaciones</h3>
                <canvas id="complicationsChart"></canvas>
            </div>
            
            <!-- Airway Difficulty -->
            <div class="chart-card">
                <h3>Dificultad de Vía Aérea</h3>
                <canvas id="airwayChart"></canvas>
            </div>
            
            <!-- Monthly Trend -->
            <div class="chart-card">
                <h3>Tendencia Mensual</h3>
                <canvas id="trendChart"></canvas>
            </div>
        </div>

        <!-- High Risk Cases -->
        <div class="risk-cases-section">
            <h3>Casos de Alto Riesgo Recientes</h3>
            <div class="risk-cases-table">
                <table>
                    <thead>
                        <tr>
                            <th>Paciente</th>
                            <th>Factores de Riesgo</th>
                            <th>Fecha</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for case in high_risk_cases %}
                        <tr>
                            <td>{{ case.patient_name }}</td>
                            <td>
                                {% for factor in case.risk_factors %}
                                <span class="risk-factor">{{ factor }}</span>
                                {% endfor %}
                            </td>
                            <td>{{ case.fecha|date:"d/m/Y" }}</td>
                            <td>
                                <a href="{% url 'presurgery-detail' case.folio %}" 
                                   class="btn btn-sm btn-primary">Ver Detalle</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script id="asa-data" type="application/json">
    {{ asa_distribution|safe }}
</script>
<script id="complications-data" type="application/json">
    {{ complications_data|safe }}
</script>
<script id="airway-metrics" type="application/json">
    {{ airway_metrics|safe }}
</script>
<script id="monthly-data" type="application/json">
    {{ monthly_data|safe }}
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<script src="{% static 'js/dashboard.js' %}"></script>
{% endblock %}